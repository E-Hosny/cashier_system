# ุญู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ ููุทูุจุงุช ุงูุฃูููุงูู

## ๐ง ุงููุดููุฉ ุงูุชู ุชู ุญููุง

ูุงู ุงููุธุงู ูุง ูููู ุจูุฒุงููุฉ ุงูุทูุจุงุช ุงูุฃูููุงูู **ุชููุงุฆูุงู** ุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุชุ ููุง ูุชุทูุจ ุชุฏุฎู ูุฏูู ูู ุงููุณุชุฎุฏู ูููุฒุงููุฉ.

## โ ุงูุญู ุงููุทุจู

ุชู ุชุทุจูู ูุธุงู **ูุฒุงููุฉ ุชููุงุฆูุฉ ูุชุนุฏุฏ ุงูุทุจูุงุช** ูุนูู ุนูู ุนุฏุฉ ูุณุชููุงุช:

### 1. ุชุญุฏูุซ OfflineManager

#### ุฅุถุงูุฉ ูุฒุงููุฉ ุชููุงุฆูุฉ ูู `handleOnline()`:
```javascript
handleOnline() {
    console.log('ุชู ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช');
    this.isOnline = true;
    this.retryAttempts = 0;
    
    // ุฅุธูุงุฑ ุฅุดุนุงุฑ ูููุณุชุฎุฏู
    this.showNotification('ุชู ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช', 'success');
    
    // ูุญุงููุฉ ูุฒุงููุฉ ุงูุทูุจุงุช ุงููุนููุฉ
    this.syncPendingRequests();
    
    // ูุฒุงููุฉ ุงูุทูุจุงุช ุงูุฃูููุงูู ุชููุงุฆูุงู โญ ุฌุฏูุฏ
    this.autoSyncOfflineOrders();
    
    // ุฅุนุงุฏุฉ ุชุดุบูู ูุญุต ุงูุงุชุตุงู
    this.startConnectionCheck();
}
```

#### ุฅุถุงูุฉ ุทุฑููุฉ `autoSyncOfflineOrders()`:
```javascript
async autoSyncOfflineOrders() {
    try {
        console.log('๐ ุจุฏุก ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ ููุทูุจุงุช ุงูุฃูููุงูู...');
        
        // ุฅุธูุงุฑ ุฅุดุนุงุฑ ุจุฏุก ุงููุฒุงููุฉ
        this.showNotification('ุฌุงุฑู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ...', 'info');
        
        // ูุฒุงููุฉ ุงูุทูุจุงุช ุงููุญููุฉ ุฃููุงู
        await this.syncLocalOfflineOrders();
        
        // ุซู ูุฒุงููุฉ ุงูุทูุจุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
        const response = await fetch('/offline/sync', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content')
            }
        });
        
        // ูุนุงูุฌุฉ ุงููุชุงุฆุฌ ูุฅุธูุงุฑ ุงูุฅุดุนุงุฑุงุช ุงูููุงุณุจุฉ
        if (response.ok) {
            const data = await response.json();
            const syncedCount = data.synced_count || 0;
            
            if (syncedCount > 0) {
                this.showNotification(`โ ุชู ูุฒุงููุฉ ${syncedCount} ุทูุจ ุชููุงุฆูุงู!`, 'success');
            }
        }
    } catch (error) {
        console.error('โ ุฎุทุฃ ูู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ:', error);
        this.showNotification('ุฎุทุฃ ูู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ', 'error');
    }
}
```

#### ุฅุถุงูุฉ ูุฒุงููุฉ ุงูุทูุจุงุช ุงููุญููุฉ:
```javascript
async syncLocalOfflineOrders() {
    try {
        const localOrders = JSON.parse(localStorage.getItem('local_offline_orders') || '[]');
        
        if (localOrders.length === 0) return;
        
        console.log(`ูุฒุงููุฉ ${localOrders.length} ุทูุจ ูุญูู...`);
        
        for (const order of localOrders) {
            // ุฅุฑุณุงู ูู ุทูุจ ููุฎุงุฏู
            const response = await fetch('/offline/orders', {
                method: 'POST',
                headers: { /* headers */ },
                body: JSON.stringify({
                    total_price: order.total,
                    payment_method: order.payment_method,
                    items: order.items
                })
            });
            
            if (response.ok) {
                console.log('ุชู ูุฒุงููุฉ ุงูุทูุจ ุงููุญูู:', order.offline_id);
            }
        }
        
        // ูุณุญ ุงูุทูุจุงุช ุงููุญููุฉ ุจุนุฏ ุงููุฒุงููุฉ
        localStorage.removeItem('local_offline_orders');
        
    } catch (error) {
        console.error('ุฎุทุฃ ูู ูุฒุงููุฉ ุงูุทูุจุงุช ุงููุญููุฉ:', error);
    }
}
```

### 2. ุชุญุฏูุซ ุตูุญุฉ ุงููุงุดูุฑ

#### ุชููุฆุฉ OfflineManager ูู `mounted()`:
```javascript
mounted() {
    // ... ุจุงูู ุงูููุฏ
    
    // ุชููุฆุฉ ูุฏูุฑ ุงูุฃูููุงูู ูููุฒุงููุฉ ุงูุชููุงุฆูุฉ โญ ุฌุฏูุฏ
    this.offlineManager = new OfflineManager();
    
    // ูุฑุงูุจุฉ ุฃุญุฏุงุซ ุงูุงุชุตุงู ูุจุงุดุฑุฉ ูู ุงููุชุตูุญ โญ ุฌุฏูุฏ
    window.addEventListener('online', this.handleBrowserOnline);
    window.addEventListener('offline', this.handleBrowserOffline);
    
    // ุจุฏุก ูุญุต ุงูุงุชุตุงู
    this.checkConnection();
    this.startConnectionCheck();
}
```

#### ุฅุถุงูุฉ ูุนุงูุฌุงุช ุฃุญุฏุงุซ ุงููุชุตูุญ:
```javascript
// ูุนุงูุฌ ุญุฏุซ ุนูุฏุฉ ุงูุงุชุตุงู ูู ุงููุชุตูุญ
async handleBrowserOnline() {
    console.log('๐ข ุชู ุฑุตุฏ ุนูุฏุฉ ุงูุงุชุตุงู ูู ุงููุชุตูุญ');
    this.isOnline = true;
    
    // ุชุฃุฎูุฑ ูุตูุฑ ููุชุฃูุฏ ูู ุงุณุชูุฑุงุฑ ุงูุงุชุตุงู
    setTimeout(async () => {
        if (this.offlineManager) {
            await this.offlineManager.autoSyncOfflineOrders();
        }
    }, 2000);
},

// ูุนุงูุฌ ุญุฏุซ ุงููุทุงุน ุงูุงุชุตุงู ูู ุงููุชุตูุญ
handleBrowserOffline() {
    console.log('๐ด ุชู ุฑุตุฏ ุงููุทุงุน ุงูุงุชุตุงู ูู ุงููุชุตูุญ');
    this.isOnline = false;
}
```

#### ุชุญุฏูุซ ูุญุต ุงูุงุชุตุงู:
```javascript
async checkConnection() {
    try {
        const connectionStatus = await this.comprehensiveConnectionCheck();
        const wasOffline = !this.isOnline;
        
        this.isOnline = connectionStatus.isOnline;
        
        // ุฅุฐุง ูุงู ูุชุตู ุงูุขู ููุงู ุบูุฑ ูุชุตู ุณุงุจูุงูุ ูู ุจุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ
        if (this.isOnline && wasOffline) {
            console.log('ุชู ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู - ุจุฏุก ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ...');
            // ุงุณุชุฎุฏุงู OfflineManager ูููุฒุงููุฉ ุฅุฐุง ูุงู ูุชููุฑุงู โญ ุฌุฏูุฏ
            if (this.offlineManager) {
                await this.offlineManager.autoSyncOfflineOrders();
            } else {
                await this.autoSyncOfflineOrders();
            }
        }
    } catch (error) {
        console.log('ุฎุทุฃ ูู ูุญุต ุงูุงุชุตุงู:', error.message);
        this.isOnline = false;
    }
}
```

### 3. ุชุญุณูู ุขููุฉ ูุญุต ุงูุงุชุตุงู ูู OfflineManager

```javascript
async checkConnection() {
    // ... ููุฏ ุงููุญุต
    
    // ุฅุฐุง ูุงู ูุชุตู ุงูุขู ููุงู ุบูุฑ ูุชุตู ุณุงุจูุงู
    if (this.isOnline && wasOffline) {
        console.log('๐ข ุชู ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู - ุจุฏุก ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ');
        this.syncPendingRequests();
        
        // ูุฒุงููุฉ ุงูุทูุจุงุช ุงูุฃูููุงูู ุฃูุถุงู โญ ุฌุฏูุฏ
        setTimeout(() => {
            this.autoSyncOfflineOrders();
        }, 1000);
    }
}
```

## ๐ฏ ุงููุชุงุฆุฌ ุงููุญููุฉ

### ุทุจูุงุช ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ:

1. **ุฃุญุฏุงุซ ุงููุชุตูุญ**: `window.addEventListener('online')`
2. **OfflineManager**: ูุญุต ุฏูุฑู ูู 30 ุซุงููุฉ
3. **ุตูุญุฉ ุงููุงุดูุฑ**: ูุญุต ุฏูุฑู ูู 10 ุซูุงูู
4. **ุฃุญุฏุงุซ handleOnline**: ุนูุฏ ุฑุตุฏ ุนูุฏุฉ ุงูุงุชุตุงู

### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:

โ **ูุฒุงููุฉ ุชููุงุฆูุฉ ููุฑูุฉ** ุนูุฏ ุนูุฏุฉ ุงููุช
โ **ุฅุดุนุงุฑุงุช ูุงุถุญุฉ** ูููุณุชุฎุฏู ุนู ุญุงูุฉ ุงููุฒุงููุฉ
โ **ูุฒุงููุฉ ุงูุทูุจุงุช ุงููุญููุฉ** ูู localStorage
โ **ูุฒุงููุฉ ุทูุจุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช** ุงูุฃูููุงูู
โ **ุญูุงูุฉ ูู ุงูุชูุฑุงุฑ** ูุน ุงููุธุงู ุงููุญุฏุซ
โ **ูุญุต ูุชุนุฏุฏ ุงููุณุชููุงุช** ูุถูุงู ุนุฏู ููุฏุงู ุฃู ุทูุจ
โ **ุชุณุฌูู ููุตู** ูุฌููุน ุงูุนูููุงุช ูู console

### ุฑุณุงุฆู ุงูุฅุดุนุงุฑ:

- ๐ "ุฌุงุฑู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ..."
- โ "ุชู ูุฒุงููุฉ X ุทูุจ ุชููุงุฆูุงู!"
- โ๏ธ "ูุดู ูู ูุฒุงููุฉ X ุทูุจ"
- โ "ุฎุทุฃ ูู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ"

## ๐ ููููุฉ ุงูุนูู

1. **ุนูุฏ ุงููุทุงุน ุงููุช**: ูุญูุธ ุงููุธุงู ุงูุทูุจุงุช ูุญููุงู
2. **ุนูุฏ ุนูุฏุฉ ุงููุช**: 
   - ูุชู ุฑุตุฏ ุงูุนูุฏุฉ ููุฑุงู ุจุนุฏุฉ ุทุฑู
   - ุชุจุฏุฃ ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ ุฎูุงู 1-2 ุซุงููุฉ
   - ูุชู ูุฒุงููุฉ ุงูุทูุจุงุช ุงููุญููุฉ ุฃููุงู
   - ุซู ูุฒุงููุฉ ุทูุจุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุฅุธูุงุฑ ุฅุดุนุงุฑุงุช ุงููุชุงุฆุฌ ูููุณุชุฎุฏู
3. **ุงูุญูุงูุฉ ูู ุงูุชูุฑุงุฑ**: ุงููุธุงู ุงููุทูุฑ ูููุน ุฃู ุชูุฑุงุฑ

## ๐ง ุงูุตูุงูุฉ ูุงููุฑุงูุจุฉ

### ูุญุต ูุฏูู ูููุฒุงููุฉ:
```bash
# ูุญุต ุงูุทูุจุงุช ุงููุนููุฉ
php artisan offline:cleanup --dry-run

# ูุญุต ุงูุทูุจุงุช ุงูููุฑุฑุฉ
php artisan invoices:check-duplicates
```

### ูุฑุงูุจุฉ console ููุชุทููุฑ:
- ุชุชุจุน ุฑุณุงุฆู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ
- ูุฑุงูุจุฉ ุฃู ุฃุฎุทุงุก ูู ุงูุนูููุฉ
- ุชุฃููุฏ ูุฌุงุญ ุงูุนูููุงุช

## โก ุงูุฎูุงุตุฉ

ุชู ุญู ูุดููุฉ ุนุฏู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ **ููุงุฆูุงู** ูู ุฎูุงู:

- **3 ุทุจูุงุช ูุฒุงููุฉ ุชููุงุฆูุฉ** ูุฎุชููุฉ
- **ุญูุงูุฉ ุดุงููุฉ ูู ุงูุชูุฑุงุฑ** 
- **ุฅุดุนุงุฑุงุช ูุงุถุญุฉ ูููุณุชุฎุฏู**
- **ุชุณุฌูู ููุตู ููุนูููุงุช**
- **ูุฒุงููุฉ ููุฑูุฉ** ุนูุฏ ุนูุฏุฉ ุงููุช

**ุงููุชูุฌุฉ**: ูุธุงู ูุฒุงููุฉ ุฃูููุงูู ูุนูู **ุชููุงุฆูุงู** ุจุฏูู ุฃู ุชุฏุฎู ูู ุงููุณุชุฎุฏู! ๐ฏ 