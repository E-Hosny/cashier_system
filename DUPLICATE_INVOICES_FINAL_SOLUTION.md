# ุงูุญู ุงูููุงุฆู ุงูุดุงูู ููุดููุฉ ุชูุฑุงุฑ ุงูููุงุชูุฑ ูู ูุธุงู ุงููุงุดูุฑ

## ๐จ ุงููุดููุฉ ุงููููุชุดูุฉ

ูุงู ูุธุงู ุงููุงุดูุฑ ูุนุงูู ูู ูุดููุฉ **ุฎุทูุฑุฉ ุฌุฏุงู** ูู ุชูุฑุงุฑ ุงูููุงุชูุฑ ุนูุฏ ุงูุนูู ูู ูุถุน ุงูุฃูููุงููุ ุญูุซ:

- ุนูุฏ ุงููุทุงุน ุงููุชุ ูุนูู ุงููุธุงู ูู ูุถุน ุงูุฃูููุงูู
- ุนูุฏ ุนูุฏุฉ ุงููุชุ ูุชู ูุฒุงููุฉ ุงูุทูุจุงุช ุชููุงุฆูุงู
- **ุงููุดููุฉ ุงูุฃุณุงุณูุฉ**: ุงุณุชุฏุนุงุกุงุช ูุชุนุฏุฏุฉ ููุชุฒุงููุฉ ูุนูููุฉ ุงููุฒุงููุฉ ูู 4 ูุตุงุฏุฑ ูุฎุชููุฉ:
  1. `OfflineManager.handleOnline()` - ุนูุฏ ุฑุตุฏ ุนูุฏุฉ ุงููุช ูู ุฃุญุฏุงุซ ุงููุชุตูุญ
  2. `OfflineManager.checkConnection()` - ูู ุงููุญุต ุงูุฏูุฑู ูู 30 ุซุงููุฉ  
  3. `Cashier.vue.handleBrowserOnline()` - ูู ุฃุญุฏุงุซ ุงููุชุตูุญ ูู ุงูุตูุญุฉ
  4. `Cashier.vue.checkConnection()` - ูู ุงููุญุต ุงูุฏูุฑู ูู 10 ุซูุงูู

## โ ุงูุญู ุงููุทุจู

### **1. ุฅุตูุงุญ ุงูุชุถุงุฑุจ ูู ุงุณุชุฏุนุงุกุงุช ุงููุฒุงููุฉ**

#### ูู `OfflineManager`:
- ุฅุถุงูุฉ ููู ุดุงูู ูููุน ุงููุฒุงููุฉ ุงููุชุนุฏุฏุฉ
- ุงุณุชุฎุฏุงู `localStorage` ูููู ุฅุถุงูู
- ุญูุงูุฉ ูู ุงููุฒุงููุฉ ุงููุชูุฑุฑุฉ (cooldown)

#### ูู `Cashier.vue`:
- ุฅุฒุงูุฉ ุงููุฒุงููุฉ ุงูููุฑุฑุฉ
- ุชุฑู `OfflineManager` ูุชููู ุงููุฒุงููุฉ ููุท
- ููุน ุงูุชุถุงุฑุจ ูู ุงุณุชุฏุนุงุกุงุช ุงููุฒุงููุฉ

### **2. ุชุญุณูู ูุธุงู ุงูุฃููุงู ูู `OfflineService`**

- ููู ุดุงูู ููุฒุงููุฉ ุงููุณุชุฎุฏู ุงููุงุญุฏ (15 ุฏูููุฉ)
- ููู ุนูููุฉ ุงููุฒุงููุฉ (10 ุฏูุงุฆู)
- ููู ุณุฑูุน ููุทูุจุงุช ุงููุชุชุงููุฉ (5 ุซูุงูู)
- ููู ุนูู ูุณุชูู ุงูุทูุจ ุงููุงุญุฏ (5 ุฏูุงุฆู)

### **3. ุชุญุณูู ูุธุงู ุชุฑููู ุงูููุงุชูุฑ**

- ููู ุฅุถุงูู ูููุน ุงูุชุถุงุฑุจ ูู ุชูููุฏ ุงูุฃุฑูุงู
- ุงูุชุญูู ุงูููุงุฆู ูู ุนุฏู ูุฌูุฏ ุงูุฑูู ูุจู ุงูุฅุฑุฌุงุน
- ุขููุฉ ุทูุงุฑุฆ ูู ุญุงูุฉ ูุดู ุงูุญุตูู ุนูู ุงูููู

### **4. ุฃูุฑ ูุญุต ุดุงูู ููููุงุชูุฑ ุงูููุฑุฑุฉ**

ุฃูุฑ ุฌุฏูุฏ `CheckDuplicateInvoices` ูููู ุจู:
- ูุญุต ุงูููุงุชูุฑ ุงูููุฑุฑุฉ ูู ุงูุฌุฏูู ุงูุนุงุฏู
- ูุญุต ุงูููุงุชูุฑ ุงูููุฑุฑุฉ ูู ุงูุฌุฏูู ุงูุฃูููุงูู
- ูุญุต ุงูุทูุจุงุช ุงููุชุทุงุจูุฉ ุชูุงูุงู ูู ุงููุญุชูู
- ูุญุต ุชุถุงุฑุจ ุงูุฃุฑูุงู ุจูู ุงูุฌุฏูููู
- ุฅุตูุงุญ ุชููุงุฆู ููููุงุชูุฑ ุงูููุฑุฑุฉ

## ๐๏ธ ููููุฉ ุงุณุชุฎุฏุงู ุงูุฃูุงูุฑ ุงูุฌุฏูุฏุฉ

### **ูุญุต ุงูููุงุชูุฑ ุงูููุฑุฑุฉ:**

```bash
# ูุญุต ุดุงูู ุจุฏูู ุฅุตูุงุญ
php artisan invoices:check-duplicates

# ูุญุต ุดุงูู ูุน ุฅุตูุงุญ ุชููุงุฆู
php artisan invoices:check-duplicates --fix
```

### **ุชูุธูู ุงูุทูุจุงุช ุงูุฃูููุงูู:**

```bash
# ุชูุธูู ุดุงูู ููุทูุจุงุช ุงูุฃูููุงูู
php artisan offline:cleanup --force

# ูุญุต ุงูุชูุฑุงุฑ ููุท
php artisan offline:cleanup --check-duplicates
```

### **ูุญุต ุดุงูู ูููุธุงู:**

```bash
# ูุญุต ุดุงูู ููููุงุชูุฑ ุงูููุฑุฑุฉ
php artisan invoices:check-duplicates --fix

# ุชูุธูู ุดุงูู ููุทูุจุงุช ุงูุฃูููุงูู
php artisan offline:cleanup --force

# ูุญุต ุงูุชูุฑุงุฑ ูู ุงูุทูุจุงุช
php artisan offline:cleanup --check-duplicates
```

## ๐ ุทุจูุงุช ุงูุญูุงูุฉ ุงููุทุจูุฉ

### **ุงูุทุจูุฉ ุงูุฃููู: ููู ุดุงูู ูููุฒุงููุฉ**
```php
$globalSyncLockKey = "global_sync_user_{$userId}";
\Illuminate\Support\Facades\Cache::put($globalSyncLockKey, true, 900); // 15 ุฏูููุฉ
```

### **ุงูุทุจูุฉ ุงูุซุงููุฉ: ููู ุนูููุฉ ุงููุฒุงููุฉ**
```php
$syncLockKey = "sync_offline_orders_{$userId}";
\Illuminate\Support\Facades\Cache::put($syncLockKey, true, 600); // 10 ุฏูุงุฆู
```

### **ุงูุทุจูุฉ ุงูุซุงูุซุฉ: ููู ุณุฑูุน ููุทูุจุงุช ุงููุชุชุงููุฉ**
```php
$quickLockKey = "sync_quick_lock_{$userId}";
\Illuminate\Support\Facades\Cache::put($quickLockKey, true, 5); // 5 ุซูุงูู
```

### **ุงูุทุจูุฉ ุงูุฑุงุจุนุฉ: ููู ุนูู ูุณุชูู ุงูุทูุจ**
```php
$orderLockKey = "sync_order_{$offlineOrder->offline_id}";
\Illuminate\Support\Facades\Cache::put($orderLockKey, true, 300); // 5 ุฏูุงุฆู
```

### **ุงูุทุจูุฉ ุงูุฎุงูุณุฉ: ููู ูุธุงู ุชุฑููู ุงูููุงุชูุฑ**
```php
$invoiceSystemLockKey = "invoice_numbering_system_lock";
\Illuminate\Support\Facades\Cache::put($invoiceSystemLockKey, Auth::id(), 900); // 15 ุฏูููุฉ
```

## ๐ ุงููุญุต ุงูุดุงูู ุงููุทุจู

### **1. ูุญุต ุงูููุงุชูุฑ ุงูููุฑุฑุฉ**
- ุงูุจุญุซ ุนู ููุณ ุฑูู ุงููุงุชูุฑุฉ ูู ุงูุฌุฏูู ุงููุงุญุฏ
- ุฅุตูุงุญ ุชููุงุฆู ุจุฅุนุงุฏุฉ ุชุฑููู ุงูููุงุชูุฑ ุงูููุฑุฑุฉ

### **2. ูุญุต ุงูุทูุจุงุช ุงููุชุทุงุจูุฉ ุชูุงูุงู**
- ุงูุจุญุซ ุนู ุทูุจุงุช ูุชุทุงุจูุฉ ูู ุงููุญุชูู ูุงูุชูููุช
- ุญุฐู ุงูุทูุจุงุช ุงูููุฑุฑุฉ ูุน ุงูุงุญุชูุงุธ ุจุงูุฃูุฏู

### **3. ูุญุต ุชุถุงุฑุจ ุงูุฃุฑูุงู ุจูู ุงูุฌุฏูููู**
- ุงูุจุญุซ ุนู ุชุถุงุฑุจ ุจูู `orders` ู `offline_orders`
- ุฅุนุงุฏุฉ ุชุฑููู ุงูุทูุจุงุช ุงูุฃูููุงูู ูุชุฌูุจ ุงูุชุถุงุฑุจ

### **4. ูุญุต ุงูุนูุงุตุฑ ูุงูุญุฑูุงุช ุงูููุฑุฑุฉ**
- ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุนูุงุตุฑ ููุฑุฑุฉ
- ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุญุฑูุงุช ูุฎุฒูู ููุฑุฑุฉ

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### **ูุจู ุงูุญู:**
- โ ุทูุจุงุช ููุฑุฑุฉ ุนูุฏ ุนูุฏุฉ ุงููุช
- โ ููุงุชูุฑ ููุฑุฑุฉ ุจููุณ ุงูุฑูู
- โ ุงุถุทุฑุงุจ ูู ุงูุญุณุงุจุงุช ูุงูุฃุฑุจุงุญ
- โ ูุดุงูู ูู ุฅุฏุงุฑุฉ ุงููุฎุฒูู

### **ุจุนุฏ ุงูุญู:**
- โ **ุนุฏู ุชูุฑุงุฑ ุงูููุงุชูุฑ** - ุญูุงูุฉ ุดุงููุฉ ูู ุงูุชุถุงุฑุจ
- โ **ูุฒุงููุฉ ุขููุฉ** - ุฃููุงู ูุชุนุฏุฏุฉ ุงููุณุชููุงุช
- โ **ุฃุฑูุงู ููุงุชูุฑ ูุฑูุฏุฉ** - ูุธุงู ุชุฑููู ูุญุณู
- โ **ูุธุงู ูุณุชูุฑ** - ุจุฏูู ุชุถุงุฑุจ ุฃู ุชูุฑุงุฑ

## ๐ ููููุฉ ุงูุงุฎุชุจุงุฑ

### **1. ุงุฎุชุจุงุฑ ุงููุฒุงููุฉ ุงููุชุนุฏุฏุฉ:**
```bash
# ุชุดุบูู ุนุฏุฉ ุนูููุงุช ูุฒุงููุฉ ูู ููุณ ุงูููุช
php artisan offline:sync &
php artisan offline:sync &
php artisan offline:sync &
```

### **2. ุงุฎุชุจุงุฑ ูุธุงู ุงูุฃููุงู:**
```bash
# ูุญุต ุญุงูุฉ ุงูุฃููุงู
php artisan cache:show | grep sync
```

### **3. ุงุฎุชุจุงุฑ ุงููุญุต ุงูุดุงูู:**
```bash
# ูุญุต ุดุงูู ูุน ุฅุตูุงุญ
php artisan invoices:check-duplicates --fix
```

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฃููุงู ุชุฎุชูู ุชููุงุฆูุงู** ุจุนุฏ ุงูุชูุงุก ุงููุฏุฉ ุงููุญุฏุฏุฉ
2. **ูู ุญุงูุฉ ุงูุทูุงุฑุฆ**ุ ุงููุธุงู ูุณุชุฎุฏู ุขููุฉ ุชุฑููู ุทูุงุฑุฆ
3. **ุงููุญุต ุงูุดุงูู** ูููู ุชุดุบููู ูู ุฃู ููุช
4. **ุงูุฅุตูุงุญ ุงูุชููุงุฆู** ุขูู ููุง ูุคุซุฑ ุนูู ุงูุจูุงูุงุช ุงูุตุญูุญุฉ

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### **ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:**

```bash
# ูุญุต ุงูุณุฌูุงุช
tail -f storage/logs/laravel.log | grep -E "(ูุฒุงููุฉ|sync|offline)"

# ูุญุต ุญุงูุฉ ุงูุฃููุงู
php artisan cache:show | grep sync

# ุชูุธูู ุดุงูู
php artisan cache:clear
php artisan invoices:check-duplicates --fix
php artisan offline:cleanup --force
```

### **ุฅุนุงุฏุฉ ุชุดุบูู ุงููุธุงู:**
```bash
# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุงุช
php artisan config:clear
php artisan route:clear
php artisan view:clear
```

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุชู ุชุทุจูู **ุญู ุดุงูู ููุชุนุฏุฏ ุงูุทุจูุงุช** ููุดููุฉ ุชูุฑุงุฑ ุงูููุงุชูุฑ:

1. **ุฅุฒุงูุฉ ุงููุฒุงููุฉ ุงูููุฑุฑุฉ** ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
2. **ูุธุงู ุฃููุงู ูุญุณู** ูููุน ุงูุชุถุงุฑุจ
3. **ูุญุต ุดุงูู** ููููุงุชูุฑ ุงูููุฑุฑุฉ
4. **ุฅุตูุงุญ ุชููุงุฆู** ูููุดุงูู ุงูููุชุดูุฉ

ุงููุชูุฌุฉ: **ูุธุงู ูุงุดูุฑ ูุณุชูุฑ ุจุฏูู ุชูุฑุงุฑ ูู ุงูููุงุชูุฑ** ๐ 