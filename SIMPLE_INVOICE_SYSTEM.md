# نظام ترقيم الفواتير البسيط

## نظرة عامة

تم تطوير نظام ترقيم بسيط للفواتير يلبي المتطلبات التالية:
- ✅ **التصفر اليومي**: يبدأ من 1 كل يوم جديد
- ✅ **سهولة القراءة**: أرقام واضحة ومفهومة
- ✅ **عدم الوضوح للزبون**: لا يبدو تسلسلياً بسيطاً
- ✅ **قابل للفك**: يمكن استخراج التاريخ والتسلسل

## تنسيق الأرقام

### التنسيق: `YYMMDD-XXX`

- **YY**: السنة (رقمان)
- **MM**: الشهر (رقمان)
- **DD**: اليوم (رقمان)
- **XXX**: التسلسل اليومي (3 أرقام)

### أمثلة:

```
التاريخ: 19 ديسمبر 2024
- الفاتورة الأولى:  241219-001
- الفاتورة الثانية: 241219-002
- الفاتورة الثالثة: 241219-003

التاريخ: 20 ديسمبر 2024
- الفاتورة الأولى:  241220-001 ← يبدأ من 1 مرة أخرى
- الفاتورة الثانية: 241220-002
```

## المميزات

### ✅ التصفر اليومي
- كل يوم يبدأ التسلسل من 001
- لا تتراكم الأرقام عبر الأيام
- سهولة تتبع الفواتير اليومية

### ✅ سهولة القراءة
- أرقام واضحة ومفهومة
- يظهر التاريخ بوضوح
- سهل التذكر والكتابة

### ✅ عدم الوضوح للزبون
- لا يبدو تسلسلياً بسيطاً مثل 1, 2, 3
- يحتوي على التاريخ مما يجعله أقل وضوحاً
- لا يمكن معرفة عدد الفواتير بسهولة

### ✅ قابل للفك والتتبع
- يمكن استخراج التاريخ والتسلسل
- التحقق من صحة الرقم
- سهولة البحث والتتبع

## الاستخدام

### 1. توليد رقم فاتورة جديد
```php
$invoiceNumber = InvoiceNumberService::generateInvoiceNumber();
// النتيجة: 241219-001
```

### 2. فك تشفير الرقم
```php
$info = InvoiceNumberService::getInvoiceInfo('241219-001');
// النتيجة:
[
    'sequence' => 1,
    'date' => '2024-12-19',
    'formatted_date' => '2024-12-19',
    'is_today' => true,
    'day_number' => 1,
    'date_code' => '241219',
    'year' => '2024',
    'month' => '12',
    'day' => '19'
]
```

### 3. التحقق من صحة الرقم
```php
$isValid = InvoiceNumberService::isValidInvoiceNumber('241219-001');
// النتيجة: true
```

## الأوامر المتاحة

### اختبار النظام
```bash
php artisan invoices:test --count=5
```

### تحديث الفواتير الموجودة
```bash
# محاكاة التحديث
php artisan invoices:update-existing --dry-run

# تطبيق التحديث
php artisan invoices:update-existing
```

## أمثلة عملية

### في الكاشير:
```php
// عند إنشاء فاتورة جديدة
$order = Order::create([
    'total' => 150.00,
    'payment_method' => 'cash',
    'status' => 'completed',
    'invoice_number' => InvoiceNumberService::generateInvoiceNumber(),
]);
// النتيجة: 241219-001
```

### في الطباعة:
```html
<h1>فاتورة رقم #241219-001</h1>
<p>التاريخ: 19 ديسمبر 2024 09:30</p>
```

### في التقارير:
```php
// البحث عن فاتورة
$order = Order::where('invoice_number', '241219-001')->first();

// التحقق من صحة الرقم
if (InvoiceNumberService::isValidInvoiceNumber('241219-001')) {
    echo "رقم فاتورة صحيح";
}
```

## المميزات الإضافية

### 1. سهولة القراءة
- الأرقام واضحة ومفهومة
- يظهر التاريخ بوضوح
- سهل التذكر والكتابة

### 2. الأداء
- فهرسة على حقل `invoice_number`
- استعلامات محسنة
- توليد سريع للأرقام

### 3. المرونة
- يمكن تغيير التنسيق بسهولة
- قابل للتطوير والتوسع
- دعم الأرقام القديمة

## التطوير المستقبلي

### تحسينات مقترحة:
1. **تخصيص التنسيق**: إمكانية تغيير تنسيق الأرقام
2. **أرقام خاصة**: أرقام مميزة للفواتير المهمة
3. **دعم السنوات**: دعم سنوات مختلفة
4. **نسخ احتياطية**: نظام نسخ احتياطية للأرقام

### مثال على التخصيص:
```php
// تنسيق مخصص: DD-MM-YY-XXX
$invoiceNumber = '19-12-24-001';

// تنسيق مخصص: YYYYMMDD-XXX
$invoiceNumber = '20241219-001';
```

## الدعم

في حالة وجود أي مشاكل أو أسئلة، يرجى التواصل مع فريق التطوير. 