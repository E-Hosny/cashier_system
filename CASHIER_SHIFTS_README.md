# نظام إدارة ورديات الكاشير

## نظرة عامة

تم إضافة نظام متكامل لإدارة ورديات الكاشير (صباحية ومسائية) مع تتبع المبيعات والمدفوعات النقدية.

## الميزات الرئيسية

### 1. إدارة الورديات
- **بدء وردية جديدة**: يمكن للكاشير بدء وردية صباحية أو مسائية
- **تقفيل الوردية**: إغلاق الوردية مع حساب إجمالي المبيعات
- **تسليم الوردية**: تسليم الوردية بعد مراجعة المدفوعات

### 2. تتبع المبيعات
- **حساب إجمالي المبيعات**: حساب تلقائي لإجمالي المبيعات في الوردية
- **المبلغ المتوقع**: حساب المبلغ المتوقع حسب النظام
- **الفرق النقدي**: حساب الفرق بين النقدي والمتوقع

### 3. واجهة المستخدم
- **أزرار إدارة الوردية**: في أعلى صفحة الكاشير
- **نوافذ منبثقة**: لبدء وتقفيل الورديات
- **عرض تفاصيل المبيعات**: نافذة تفصيلية للمراجعة

## كيفية الاستخدام

### بدء وردية جديدة
1. الضغط على زر "بدء وردية" في أعلى الصفحة
2. اختيار نوع الوردية (صباحية أو مسائية)
3. الضغط على "بدء الوردية"

### تقفيل الوردية
1. الضغط على زر "تقفيل الوردية" عند انتهاء الوردية
2. تأكيد التقفيل في النافذة المنبثقة
3. مراجعة تفاصيل المبيعات

### تسليم الوردية
1. إدخال المبلغ النقدي الموجود في الصندوق
2. مراجعة الفرق بين النقدي والمتوقع
3. إضافة ملاحظات (اختياري)
4. الضغط على "تم التسليم"

## الجداول المضافة

### جدول cashier_shifts
- `id`: معرف الوردية
- `user_id`: معرف المستخدم
- `shift_type`: نوع الوردية (morning/evening)
- `start_time`: وقت بداية الوردية
- `end_time`: وقت انتهاء الوردية
- `total_sales`: إجمالي المبيعات
- `cash_amount`: المبلغ النقدي
- `expected_amount`: المبلغ المتوقع
- `difference`: الفرق بين النقدي والمتوقع
- `notes`: ملاحظات
- `status`: حالة الوردية (active/closed/handed_over)

### تحديث جدول orders
- إضافة عمود `cashier_shift_id` لربط الطلبات بالورديات

## الملفات المضافة/المحدثة

### Models
- `app/Models/CashierShift.php` - نموذج ورديات الكاشير
- `app/Models/Order.php` - تحديث لإضافة العلاقة مع الورديات
- `app/Models/User.php` - إضافة العلاقة مع الورديات

### Controllers
- `app/Http/Controllers/CashierShiftController.php` - Controller إدارة الورديات
- `app/Http/Controllers/CashierController.php` - تحديث لربط الطلبات بالورديات

### Views
- `resources/js/Pages/Cashier.vue` - تحديث واجهة الكاشير

### Migrations
- `database/migrations/2025_01_15_000000_create_cashier_shifts_table.php`
- `database/migrations/2025_01_15_000001_add_cashier_shift_id_to_orders_table.php`

### Routes
- إضافة routes جديدة لإدارة الورديات في `routes/web.php`

## API Endpoints

### إدارة الورديات
- `POST /cashier-shifts/start` - بدء وردية جديدة
- `POST /cashier-shifts/close` - تقفيل الوردية
- `POST /cashier-shifts/handover` - تسليم الوردية
- `PUT /cashier-shifts/{shift}/update-cash` - تحديث المبلغ النقدي
- `GET /cashier-shifts/current` - الحصول على الوردية الحالية
- `GET /cashier-shifts/details` - تفاصيل الوردية
- `GET /cashier-shifts/history` - تاريخ الورديات
- `GET /cashier-shifts/stats` - إحصائيات الورديات

## الأمان والصلاحيات

- يمكن للمستخدم الوصول فقط لوردياته الخاصة
- المديرون يمكنهم الوصول لجميع الورديات
- التحقق من صحة البيانات في جميع العمليات

## الأداء

- استخدام فهارس لتحسين الأداء
- تجميع العمليات لتقليل عدد الاستعلامات
- تحسين استعلامات المبيعات

## ملاحظات تقنية

- النظام يحسب المبيعات تلقائياً حسب الوردية
- عند عدم وجود وردية سابقة، يتم الحساب من بداية اليوم
- يمكن إضافة ملاحظات لكل وردية
- النظام يدعم ورديات متعددة في نفس اليوم 