# نظام ترقيم الفواتير الذكي

## نظرة عامة

تم تطوير نظام ترقيم ذكي للفواتير يلبي المتطلبات التالية:
- ✅ **التصفر اليومي**: يبدأ من 1 كل يوم جديد
- ✅ **عدم الوضوح للزبون**: أرقام مشفرة وغير واضحة
- ✅ **عدم العشوائية**: قابل للفك والتتبع

## كيفية العمل

### 1. توليد رقم الفاتورة

النظام يقوم بتوليد رقم فاتورة يتكون من:
- **تاريخ اليوم** (4 أرقام: MM-DD)
- **التسلسل اليومي** (3 أرقام: 001, 002, ...)
- **لاحقة عشوائية** (2 أرقام: 10-99)
- **تشفير بسيط** لجميع الأرقام

### 2. مثال على الأرقام

```
التاريخ: 19 ديسمبر 2024
التسلسل: 1
الرقم المشفر: A2B3C4D5E
```

### 3. فك التشفير

يمكن فك تشفير الرقم للحصول على:
- التسلسل اليومي
- تاريخ الفاتورة
- التحقق من الصحة

## الملفات المضافة/المحدثة

### 1. قاعدة البيانات
- `database/migrations/2025_12_19_000000_add_invoice_number_to_orders_table.php`

### 2. الخدمات
- `app/Services/InvoiceNumberService.php`

### 3. النماذج
- `app/Models/Order.php` (محدث)

### 4. المتحكمات
- `app/Http/Controllers/CashierController.php` (محدث)

### 5. القوالب
- `resources/views/Invoice.blade.php` (محدث)
- `resources/views/invoice-html.blade.php` (محدث)

### 6. الأوامر
- `app/Console/Commands/UpdateExistingInvoices.php`
- `app/Console/Commands/TestInvoiceNumbers.php`

## الأوامر المتاحة

### 1. تحديث الفواتير الموجودة
```bash
# محاكاة التحديث (بدون تغييرات فعلية)
php artisan invoices:update-existing --dry-run

# تطبيق التحديث
php artisan invoices:update-existing
```

### 2. اختبار النظام
```bash
# توليد 5 أرقام فواتير للاختبار
php artisan invoices:test

# توليد 10 أرقام فواتير للاختبار
php artisan invoices:test --count=10
```

## التطبيق

### 1. تشغيل Migration
```bash
php artisan migrate
```

### 2. تحديث الفواتير الموجودة
```bash
php artisan invoices:update-existing
```

### 3. اختبار النظام
```bash
php artisan invoices:test
```

## المميزات

### ✅ التصفر اليومي
- كل يوم يبدأ التسلسل من 1
- لا تتراكم الأرقام عبر الأيام

### ✅ عدم الوضوح للزبون
- أرقام مشفرة تبدو عشوائية
- لا يمكن معرفة عدد الفواتير بسهولة

### ✅ عدم العشوائية
- قابل للفك والتتبع
- يمكن استخراج التاريخ والتسلسل
- التحقق من صحة الرقم

### ✅ الأداء
- فهرسة على حقل `invoice_number`
- استعلامات محسنة

## الأمان

- التشفير بسيط وغير قابل للكسر بسهولة
- يمكن تغيير خوارزمية التشفير مستقبلاً
- التحقق من صحة الأرقام

## التطوير المستقبلي

1. **تشفير أقوى**: استخدام خوارزميات تشفير أكثر تعقيداً
2. **أرقام خاصة**: إضافة أرقام خاصة للفواتير المهمة
3. **تخصيص**: إمكانية تخصيص تنسيق الأرقام
4. **نسخ احتياطية**: نظام نسخ احتياطية لأرقام الفواتير

## الدعم

في حالة وجود أي مشاكل أو أسئلة، يرجى التواصل مع فريق التطوير. 