# دليل اختبار النظام بدون إنترنت

## نظرة عامة
تم تطوير آلية عمل بدون إنترنت (Offline Mode) للنظام لضمان استمرارية العمل حتى عند انقطاع الإنترنت. هذا الدليل يوضح كيفية اختبار هذه الميزة.

## الميزات المتاحة بدون إنترنت

### 1. طباعة الفواتير
- يمكن طباعة الفواتير محلياً حتى بدون إنترنت
- يتم حفظ الطلبات في IndexedDB و localStorage
- يتم مزامنة الطلبات تلقائياً عند عودة الإنترنت

### 2. إدارة المخزون
- يتم تحديث المخزون محلياً
- يتم مزامنة التحديثات عند عودة الإنترنت

### 3. Service Worker
- يحفظ الموارد الأساسية للعمل بدون إنترنت
- يوفر تجربة مستخدم سلسة

## كيفية الاختبار

### الطريقة الأولى: استخدام صفحة الاختبار
1. انتقل إلى `/test-offline`
2. ستجد أزرار لاختبار مختلف الوظائف
3. يمكنك اختبار:
   - فحص الاتصال
   - طباعة فاتورة محلية
   - اختبار Service Worker
   - اختبار IndexedDB

### الطريقة الثانية: اختبار يدوي
1. افتح واجهة الكاشير (`/cashier`)
2. أضف منتجات إلى السلة
3. قطع الإنترنت (يمكنك إيقاف Wi-Fi أو استخدام أدوات المطور)
4. حاول إصدار فاتورة
5. يجب أن تعمل الطباعة محلياً

## خطوات الاختبار التفصيلية

### 1. اختبار طباعة الفاتورة بدون إنترنت
```bash
# 1. افتح المتصفح وانتقل إلى
http://localhost/cashier_system/test-offline

# 2. اضغط على "اختبار طباعة فاتورة محلية"
# 3. يجب أن تفتح نافذة الطباعة
```

### 2. اختبار الكاشير بدون إنترنت
```bash
# 1. افتح واجهة الكاشير
http://localhost/cashier_system/cashier

# 2. أضف منتجات إلى السلة
# 3. قطع الإنترنت
# 4. اضغط "إصدار فاتورة محلية"
# 5. يجب أن تظهر رسالة تأكيد وطباعة الفاتورة
```

### 3. اختبار المزامنة
```bash
# 1. قم بإنشاء عدة فواتير بدون إنترنت
# 2. أعد الاتصال بالإنترنت
# 3. يجب أن تظهر رسالة "تم مزامنة الطلبات"
# 4. تحقق من تقرير المبيعات للتأكد من ظهور الطلبات
```

## مؤشرات النجاح

### ✅ مؤشرات إيجابية
- ظهور رسالة "وضع عدم الاتصال" في أعلى الصفحة
- عمل زر "إصدار فاتورة محلية"
- طباعة الفاتورة بنجاح
- ظهور معرف فريد للطلب المحلي
- مزامنة الطلبات عند عودة الإنترنت

### ❌ مؤشرات الفشل
- عدم ظهور رسالة وضع عدم الاتصال
- عدم عمل الطباعة
- عدم حفظ الطلبات محلياً
- عدم المزامنة عند عودة الإنترنت

## استكشاف الأخطاء

### مشكلة: لا تعمل الطباعة
**الحل:**
1. تحقق من إعدادات الطباعة في المتصفح
2. تأكد من عدم حظر النوافذ المنبثقة
3. جرب استخدام Ctrl+P للطباعة اليدوية

### مشكلة: لا يتم حفظ الطلبات محلياً
**الحل:**
1. تحقق من دعم IndexedDB في المتصفح
2. افتح أدوات المطور وتحقق من Console للأخطاء
3. تأكد من تفعيل Service Worker

### مشكلة: لا تعمل المزامنة
**الحل:**
1. تحقق من الاتصال بالإنترنت
2. تحقق من عمل API endpoints
3. راجع سجلات الخادم للأخطاء

## ملفات مهمة للنظام بدون إنترنت

### Frontend
- `resources/js/Pages/Cashier.vue` - واجهة الكاشير مع دعم العمل بدون إنترنت
- `public/sw.js` - Service Worker للعمل بدون إنترنت
- `resources/views/test-offline.blade.php` - صفحة اختبار النظام

### Backend
- `app/Http/Controllers/Api/OfflineController.php` - معالج الطلبات بدون إنترنت
- `routes/api.php` - مسارات API للنظام بدون إنترنت

### Database
- جدول `orders` مع عمود `offline_id` لتتبع الطلبات المحلية

## نصائح للاختبار

1. **استخدم أدوات المطور**: افتح Console لمراقبة الأخطاء
2. **اختبر على متصفحات مختلفة**: Chrome, Firefox, Safari
3. **اختبر حالات مختلفة**: قطع الإنترنت أثناء العمل، إعادة الاتصال
4. **تحقق من الأداء**: تأكد من سرعة الاستجابة

## دعم المتصفحات

### مدعوم بالكامل
- Chrome 60+
- Firefox 55+
- Edge 79+

### مدعوم جزئياً
- Safari 11.1+ (قد تحتاج لتفعيل يدوي لـ Service Worker)

### غير مدعوم
- Internet Explorer
- المتصفحات القديمة

## ملاحظات مهمة

1. **حجم التخزين**: IndexedDB محدود بـ 50MB في معظم المتصفحات
2. **مدة التخزين**: البيانات المحفوظة قد تُحذف تلقائياً بعد فترة
3. **الأمان**: البيانات المحفوظة محلياً غير مشفرة
4. **المزامنة**: قد تستغرق المزامنة وقتاً حسب حجم البيانات

## الدعم الفني

إذا واجهت مشاكل في النظام بدون إنترنت:
1. تحقق من هذا الدليل أولاً
2. راجع سجلات الأخطاء في Console
3. تأكد من تحديث المتصفح
4. اختبر على متصفح آخر 