# تحديث نظام المصروفات - الساعة 7 صباحاً

## التحديثات المطبقة

### 1. تعديل توقيت حساب المصروفات
- **قبل التحديث**: كانت المصروفات تُحسب حسب تاريخ المصروف فقط
- **بعد التحديث**: أصبحت المصروفات تُحسب من الساعة 7:00 صباحاً من اليوم المحدد إلى الساعة 7:00 صباحاً من اليوم التالي

### 2. التعديلات في كنترولر المصروفات
**ملف**: `app/Http/Controllers/ExpenseController.php`

```php
// قبل التحديث
$query->whereDate('expense_date', $request->expense_date);

// بعد التحديث
$query->whereBetween('created_at', [
    Carbon::parse($request->expense_date)->setTime(7, 0, 0), // بداية من الساعة 7 صباحاً
    Carbon::parse($request->expense_date)->addDay()->setTime(7, 0, 0) // إلى الساعة 7 صباحاً من اليوم التالي
]);
```

### 3. التعديلات في الواجهة الأمامية
**ملف**: `resources/js/Pages/Expenses/Index.vue`

#### أ. إضافة ملاحظة توضيحية
```vue
<div class="mb-4 text-sm text-blue-600 bg-blue-50 p-3 rounded-lg">
  ⚠️ ملاحظة: المصروفات تُحسب من الساعة 7:00 صباحاً إلى الساعة 7:00 صباحاً من اليوم التالي
</div>
```

#### ب. تحسين عرض إجمالي المصروفات
```vue
<span v-if="filtersLocal.expense_date && !filtersLocal.from && !filtersLocal.to">
  ليوم {{ formatDate(filtersLocal.expense_date) }} (من الساعة 7:00 صباحاً إلى الساعة 7:00 صباحاً من اليوم التالي)
</span>
```

#### ج. تحميل تلقائي للبيانات
- إضافة `onMounted()` hook لتحميل البيانات تلقائياً عند فتح الصفحة
- التاريخ الافتراضي هو اليوم الحالي

### 4. تحديث تقارير المبيعات
**ملف**: `app/Http/Controllers/Admin/SalesReportController.php`

تم تحديث حساب إجمالي المصروفات في تقارير المبيعات لتطبق نفس منطق الساعة 7 إلى 7:

```php
$totalExpenses = \App\Models\Expense::whereBetween('created_at', [
    Carbon::parse($dateFrom)->setTime(7, 0, 0), // بداية من الساعة 7 صباحاً
    Carbon::parse($dateFrom)->addDay()->setTime(7, 0, 0) // إلى الساعة 7 صباحاً من اليوم التالي
])->sum('amount');
```

## الميزات الجديدة

### 1. تحميل تلقائي للبيانات
- عند فتح صفحة المصروفات، يتم تحميل بيانات اليوم الحالي تلقائياً
- التاريخ الافتراضي هو اليوم الحالي

### 2. عرض واضح للتوقيت
- إضافة ملاحظة توضيحية أن المصروفات تُحسب من الساعة 7 صباحاً إلى الساعة 7 صباحاً من اليوم التالي
- عرض التوقيت في إجمالي المصروفات

### 3. توحيد المنطق مع المبيعات
- نفس منطق التوقيت في المبيعات والمصروفات
- دقة في التقارير المالية

## كيفية الاستخدام

### 1. عرض مصروفات اليوم الحالي
- افتح صفحة المصروفات
- ستظهر مصروفات اليوم الحالي تلقائياً (من الساعة 7 صباحاً إلى الساعة 7 صباحاً من الغد)

### 2. عرض مصروفات يوم محدد
- اختر التاريخ المطلوب في حقل "يوم محدد"
- اضغط "بحث"
- ستظهر المصروفات من الساعة 7 صباحاً في ذلك اليوم إلى الساعة 7 صباحاً من اليوم التالي

### 3. عرض مصروفات فترة زمنية
- اختر تاريخ البداية في حقل "من تاريخ"
- اختر تاريخ النهاية في حقل "إلى تاريخ"
- اضغط "بحث"
- ستظهر المصروفات من الساعة 7 صباحاً في يوم البداية إلى الساعة 7 صباحاً من يوم النهاية

### 4. عرض المصروفات في تقارير المبيعات
- في صفحة تقارير المبيعات، ستظهر إجمالي المصروفات للفترة المحددة
- المصروفات تُحسب بنفس منطق المبيعات (من 7 إلى 7)

## أمثلة عملية

### مثال 1: مصروفات يوم 15 يناير
- **من**: 15 يناير الساعة 7:00 صباحاً
- **إلى**: 16 يناير الساعة 7:00 صباحاً
- **النتيجة**: جميع المصروفات خلال يوم العمل الكامل

### مثال 2: مصروفات فترة من 15 إلى 17 يناير
- **من**: 15 يناير الساعة 7:00 صباحاً
- **إلى**: 18 يناير الساعة 7:00 صباحاً
- **النتيجة**: جميع المصروفات خلال 3 أيام عمل كاملة

## الفوائد

1. **دقة في التقارير**: حساب المصروفات حسب يوم العمل الفعلي (من 7 صباحاً إلى 7 صباحاً)
2. **سهولة الاستخدام**: تحميل تلقائي لبيانات اليوم الحالي
3. **وضوح المعلومات**: عرض واضح للتوقيت المستخدم في الحسابات
4. **توحيد المنطق**: نفس منطق التوقيت في المبيعات والمصروفات
5. **مرونة في الاستعلام**: دعم الفترات الزمنية المختلفة
6. **منطقية في العمل**: يمثل يوم عمل كامل من بداية الدوام إلى بداية الدوام التالي

## التوافق

- جميع الميزات السابقة تعمل كما هي
- لا يوجد تأثير على البيانات الموجودة
- التحديث متوافق مع جميع المتصفحات
- توحيد كامل مع نظام المبيعات 