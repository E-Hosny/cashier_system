# إصلاح رابط المصروفات من صفحة تقارير المبيعات

## المشكلة
عند النقر على رابط المصروفات من صفحة تقارير المبيعات، كان يتم إرسال `expense_date` بدلاً من استخدام منطق الفترة الزمنية (7 صباحاً - 7 صباحاً) المستخدم في باقي النظام.

## الحل
تم تحديث دالة `goToExpenses()` في صفحة تقارير المبيعات لترسل معاملات `from` و `to` بدلاً من `expense_date`، مما يضمن تطبيق منطق الفترة الزمنية الموحد.

## التغييرات المطبقة

### 1. تحديث دالة goToExpenses في SalesReport.vue

#### قبل الإصلاح:
```javascript
// دالة الانتقال لصفحة المصروفات مع التاريخ المحدد
goToExpenses() {
  let expenseParams = {};
  
  // تحديد نوع التاريخ المحدد
  if (this.dateFrom && !this.dateTo) {
    // إذا تم تحديد يوم واحد فقط
    expenseParams = {
      expense_date: this.dateFrom
    };
  } else if (this.dateFrom && this.dateTo) {
    // إذا تم تحديد فترة من-إلى
    expenseParams = {
      from: this.dateFrom,
      to: this.dateTo
    };
  } else {
    // افتراضياً: التاريخ الصحيح بناءً على الوقت الحالي
    expenseParams = {
      expense_date: this.getTodayDate()
    };
  }
  
  Inertia.get(route('expenses.index'), expenseParams);
}
```

#### بعد الإصلاح:
```javascript
// دالة الانتقال لصفحة المصروفات مع التاريخ المحدد
goToExpenses() {
  let expenseParams = {};
  
  // تحديد نوع التاريخ المحدد
  if (this.dateFrom && !this.dateTo) {
    // إذا تم تحديد يوم واحد فقط - نستخدم منطق الفترة الزمنية
    // بدلاً من expense_date، نستخدم from و to لتطبيق منطق 7 صباحاً - 7 صباحاً
    const startDate = new Date(this.dateFrom);
    const endDate = new Date(this.dateFrom);
    endDate.setDate(endDate.getDate() + 1);
    
    expenseParams = {
      from: startDate.toISOString().slice(0, 10),
      to: endDate.toISOString().slice(0, 10)
    };
  } else if (this.dateFrom && this.dateTo) {
    // إذا تم تحديد فترة من-إلى
    expenseParams = {
      from: this.dateFrom,
      to: this.dateTo
    };
  } else {
    // افتراضياً: التاريخ الصحيح بناءً على الوقت الحالي
    const today = this.getTodayDate();
    const startDate = new Date(today);
    const endDate = new Date(today);
    endDate.setDate(endDate.getDate() + 1);
    
    expenseParams = {
      from: startDate.toISOString().slice(0, 10),
      to: endDate.toISOString().slice(0, 10)
    };
  }
  
  Inertia.get(route('expenses.index'), expenseParams);
}
```

## النتائج

### قبل الإصلاح:
- **يوم واحد**: يرسل `expense_date=2025-07-17`
- **فترة**: يرسل `from=2025-07-17&to=2025-07-18`
- **افتراضي**: يرسل `expense_date=2025-07-17`

### بعد الإصلاح:
- **يوم واحد**: يرسل `from=2025-07-17&to=2025-07-18` (فترة من 7 صباحاً إلى 7 صباحاً)
- **فترة**: يرسل `from=2025-07-17&to=2025-07-18`
- **افتراضي**: يرسل `from=2025-07-17&to=2025-07-18` (فترة من 7 صباحاً إلى 7 صباحاً)

## أمثلة عملية

### المثال الأول: تقرير يوم 17 يوليو
- **في تقرير المبيعات**: يعرض مبيعات يوم 17 يوليو (من 7 صباحاً إلى 7 صباحاً 18 يوليو)
- **عند النقر على المصروفات**: ينتقل إلى صفحة المصروفات مع `from=2025-07-17&to=2025-07-18`
- **النتيجة**: يعرض المصروفات من 7 صباحاً 17 يوليو إلى 7 صباحاً 18 يوليو

### المثال الثاني: تقرير فترة من 15 إلى 17 يوليو
- **في تقرير المبيعات**: يعرض مبيعات الفترة من 15 إلى 17 يوليو
- **عند النقر على المصروفات**: ينتقل إلى صفحة المصروفات مع `from=2025-07-15&to=2025-07-17`
- **النتيجة**: يعرض المصروفات للفترة المحددة

## الاختبار

### اختبار تقرير يوم 17 يوليو:
```bash
# المعاملات المرسلة: from=2025-07-17&to=2025-07-18
# الفترة المطبقة: 2025-07-17 07:00:00 إلى 2025-07-18 07:00:00
# المصروفات الموجودة:
ID: 4, Description: تت, Amount: 10.00, Created: 2025-07-18 04:25:03
ID: 6, Description: الالال, Amount: 88.00, Created: 2025-07-18 04:25:48
ID: 7, Description: تتات, Amount: 77.00, Created: 2025-07-18 04:26:23
ID: 8, Description: تت, Amount: 99.00, Created: 2025-07-18 04:27:10
ID: 9, Description: تت, Amount: 66.00, Created: 2025-07-18 04:51:54
ID: 10, Description: اا, Amount: 878.00, Created: 2025-07-18 04:56:44
```

**النتيجة**: ✅ يعرض المصروفات الصحيحة للفترة المحددة

## الفوائد

1. **توحيد المنطق**: جميع الروابط من تقرير المبيعات تطبق نفس منطق الفترة الزمنية
2. **دقة البيانات**: المصروفات تُعرض للفترة الصحيحة المطابقة للمبيعات
3. **اتساق التجربة**: نفس الفترة الزمنية تُطبق في جميع الصفحات
4. **سهولة الاستخدام**: المستخدم يرى نفس الفترة في جميع التقارير

## الملفات المحدثة

- `resources/js/Pages/Admin/SalesReport.vue` - تحديث دالة `goToExpenses()`

## الخلاصة

تم إصلاح رابط المصروفات من صفحة تقارير المبيعات بنجاح. الآن:

- ✅ عند النقر على المصروفات من تقرير يوم واحد: ينتقل مع فترة من 7 صباحاً إلى 7 صباحاً
- ✅ عند النقر على المصروفات من تقرير فترة: ينتقل مع نفس الفترة
- ✅ جميع الروابط تطبق منطق الفترة الزمنية الموحد
- ✅ البيانات معروضة بشكل متسق في جميع الصفحات 